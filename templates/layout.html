<!DOCTYPE html>
{% load static %}
<html lang="fr" data-bs-theme="light" data-pwa="true">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />

  <title>{% block title %}Location Voiture Sénégal{% endblock %}</title>
  <meta name="description" content="{% block meta_description %}Location de voitures avec chauffeur au Sénégal.{% endblock %}">
  <meta name="keywords" content="location voiture, chauffeur, Sénégal, Dakar">

  <!-- Webmanifest + Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'assets/app-icons/icon-32x32.png' %}">
  <link rel="apple-touch-icon" href="{% static 'assets/app-icons/icon-180x180.png' %}">
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />

  <!-- Preloaded local web fonts -->
  <link rel="preload" href="{% static 'assets/fonts/inter-variable-latin.woff2' %}" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="{% static 'assets/icons/finder-icons.woff2' %}" as="font" type="font/woff2" crossorigin>
  <link rel="stylesheet" href="{% static 'assets/icons/finder-icons.min.css' %}">

  <!-- Vendor styles -->
  <link rel="stylesheet" href="{% static 'assets/vendor/swiper/swiper-bundle.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/vendor/choices.js/choices.min.css' %}">

  <!-- Bootstrap + Theme styles -->
  <link rel="preload" href="{% static 'assets/css/theme.min.css' %}" as="style" />
  <link rel="stylesheet" href="{% static 'assets/css/theme.min.css' %}" id="theme-styles" />
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">

  {% block extra_css %}{% endblock %}
  <script src="{% static 'assets/js/customizer.min.js' %}" defer></script>
</head>

<body id="top">
  <!-- Header -->
  {% include 'partials/header.html' %}

  <!-- Page content -->
  {% block content %}{% endblock %}

  <!-- Footer -->
  {% include 'partials/footer.html' %}

  <!-- Vendor scripts -->
  <script src="{% static 'assets/vendor/swiper/swiper-bundle.min.js' %}" defer></script>
  <script src="{% static 'assets/vendor/choices.js/choices.min.js' %}" defer></script>
  <script src="{% static 'assets/vendor/cleave.js/cleave.min.js' %}" defer></script>

  <!-- Bootstrap + Theme scripts -->
  <script src="{% static 'assets/js/theme.min.js' %}" defer></script>
  <script src="{% static 'assets/js/script.js' %}"></script>


 <script>
(function () {
  const MAX = 6;
  const grid = document.getElementById('photo-grid');
  const addBtn = document.getElementById('add-photo');
  const totalInput = document.querySelector('input[name="{{ photo_formset.prefix }}-TOTAL_FORMS"]');

  function activeItems(){ return [...grid.querySelectorAll('.photo-item')].filter(el => !el.querySelector('input[name$="-DELETE"]')?.checked); }
  function ensureCover(){
    const covers = activeItems().map(el => el.querySelector('input[name$="-is_cover"]'));
    if (!covers.some(c => c && c.checked)) { const first = activeItems()[0]; if (first){ first.querySelector('input[name$="-is_cover"]').checked = true; } }
  }
  function renumber(){ activeItems().forEach((el,i)=>{ const o=el.querySelector('input[name$="-order"]'); if(o) o.value=i; }); }

  ensureCover(); renumber();

  addBtn?.addEventListener('click', () => {
    if (activeItems().length >= MAX) { alert(`Maximum ${MAX} photos.`); return; }
    const idx = parseInt(totalInput.value, 10);
    const html = document.getElementById('empty-photo-form').innerHTML.replaceAll('__prefix__', idx);
    const w = document.createElement('div'); w.innerHTML = html.trim();
    grid.insertBefore(w.firstElementChild, addBtn.closest('.col'));
    totalInput.value = idx + 1;
    ensureCover(); renumber();
  });

  grid.addEventListener('change', e => {
    if (e.target.name && e.target.name.endsWith('-DELETE')) { setTimeout(()=>{ ensureCover(); renumber(); },0); }
  });
})();
</script>

  {% block extra_js %}{% endblock %}
</body>
</html>
